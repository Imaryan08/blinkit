<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
    <link rel="stylesheet" href="styles/cart.css">
    <link data-react-helmet="true" rel="icon" href="https://blinkit.com/images/faviconChange.ico" type="image/x-icon">
</head>
<body>
    <nav id="nav"></nav>
    <div id="cart"></div>
    <main id="panel" class="panel">
    <button>get location</button>
    </main>
</body>
</html>

<script type="module">
    import {navbar, cart} from './components/navbar.js';
    import cartBuilder from './scripts/cart.js';

    document.getElementById('nav').innerHTML = navbar();
    document.getElementById('cart').innerHTML = cart();

    cartBuilder();


    // b71feba224f94a209d1bdd18ee8bba3a
    let button = document.querySelector('button');
    button.addEventListener('click', () =>{
        if(navigator)
            navigator.geolocation.getCurrentPosition( (position) => {
                console.log(position);
                let longitude = position.coords.longitude;
                let latitude = position.coords.latitude;

                getLocation(longitude,latitude);
            })
        else    
            console.log('geolocation is not supported');
    })


    let getLocation = async(longitude, latitude) => {

        button.innerText = "Detecting your location...";
        fetch(`https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=b71feba224f94a209d1bdd18ee8bba3a`)
        .then(response => response.json()).then(response =>{
        
        let allDetails = response.results[0].components;
            console.table(allDetails);
        
        let {county, postcode, country} = allDetails;
        button.innerText = `${county} ${postcode}, ${country}`;
        })
        .catch(()=>{
        button.innerText = "Something went wrong";

    });
    }


    function onError(error){
    if(error.code == 1){
        button.innerText = "You denied the request";
    }else if(error.code == 2){
        button.innerText = "Location is unavailable";
    }else{
        button.innerText = "Something went wrong";
    }
    button.setAttribute("disabled", "true");
}
</script>




